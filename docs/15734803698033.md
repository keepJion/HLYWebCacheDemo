# YYImage 解析
* 图片处理：一张图片从磁盘中显示到屏幕上的大致过程：从磁盘加载图片信息、解码二进制图片数据为位图、通过CoreAnimation框架处理最终绘制到屏幕上。最耗时的是解码过程
* imageWithName: 和 imageWithData的区别

```
imageWithName: 方法加载图片信息的同时，还会把图片信息缓存起来，第一次加载耗时多，之后再次加载会非常快(未解压)这些缓存是全局的，只会在收到内存警告或者第一次进入后台的时候有可能被清除，会产生全局缓存，适合小且使用频繁的图片
imageWithData: 加载图片，不管是加载还是解压都不会缓存，当实例释放相关的图片信息和解压过程信息就销毁，适合图片大且低频使用的图片

```
* 类

```
YYImage     //继承UIImage
YYFrameImage   //继承UIImage 帧动画图片类 可以配置每一帧的图片信息和显示时长
YYSpriteSheetImage //继承UIImage
YYAnimationImageView //继承UIImageView处理自定义图片类
YYImageCoder   //图片编码和解码
```

* YYImage 

```
+ (YYImage *)imageNamed:(NSString *)name {
    ...
    NSArray *exts = ext.length > 0 ? @[ext] : @[@"", @"png", @"jpeg", @"jpg", @"gif", @"webp", @"apng"];
    NSArray *scales = _NSBundlePreferredScales();
    for (int s = 0; s < scales.count; s++) {
        scale = ((NSNumber *)scales[s]).floatValue;
        NSString *scaledName = _NSStringByAppendingNameScale(res, scale);
        for (NSString *e in exts) {
            path = [[NSBundle mainBundle] pathForResource:scaledName ofType:e];
            if (path) break;
        }
        if (path) break;
    }
    ...
    return [[self alloc] initWithData:data scale:scale];
}
```

* YYFrameImage

```
- (nullable instancetype)initWithImagePaths:(NSArray<NSString *> *)paths
                             frameDurations:(NSArray<NSNumber *> *)frameDurations
                                  loopCount:(NSUInteger)loopCount;
- (nullable instancetype)initWithImageDataArray:(NSArray<NSData *> *)dataArray
                                 frameDurations:(NSArray *)frameDurations
                                      loopCount:(NSUInteger)loopCount;
```

* YYAnimatedImage Protocol

```
//YYAnimatedImage Protocol
@protocol YYAnimatedImage <NSObject>
@required
/// Total animated frame count.
/// If the frame count is less than 1, then the methods below will be ignored.  -----帧数量
- (NSUInteger)animatedImageFrameCount;

/// Animation loop count, 0 means infinite looping. ---动画循环次数
- (NSUInteger)animatedImageLoopCount;

/// Bytes per frame (in memory). It may used to optimize memory buffer size.  ----每帧在内存中的大小
- (NSUInteger)animatedImageBytesPerFrame;

/// Returns the frame image from a specified index.
/// This method may be called on background thread.
/// @param index  Frame index (zero based). ----下标为index的帧图片
- (nullable UIImage *)animatedImageFrameAtIndex:(NSUInteger)index;

/// Returns the frames's duration from a specified index.
/// @param index  Frame index (zero based). ----index下标的帧图片持续时间
- (NSTimeInterval)animatedImageDurationAtIndex:(NSUInteger)index;

@optional
/// A rectangle in image coordinates defining the subrectangle of the image that
/// will be displayed. The rectangle should not outside the image's bounds.
/// It may used to display sprite animation with a single image (sprite sheet). ----index下标帧图片的范围（CGRect）
- (CGRect)animatedImageContentsRectAtIndex:(NSUInteger)index;
@end
```
* YYAnimatedImageView 

```
  通过YYImage YYFrameImage YYSpriteSheetImage 实现的协议方法拿到帧图片数据和相关信息进行动画展示
  //初始化配置
- (void)imageChanged {}
```

* 异步解压
_YYAnimatedImageViewFetchOperation 继承NSOperation
```
NSOperationQueue 重写main方法自定义解压任务，
```

* 缓存机制

```
NSMutableDictionary *_buffer; 缓存池，
```


